# Salesforce Code Quality Manual Test Workflow
#
# Purpose:
# This workflow allows manual testing of the action against Salesforce code files.
# It scans all files (not just changed ones) and is useful for:
# - Testing the action manually
# - Debugging issues
# - Demonstrating functionality
# - Running quality checks on any branch

name: Salesforce Code Quality Manual Test

on:
  workflow_dispatch:
    inputs:
      fail_on_issues:
        description: 'Fail workflow if quality issues are found'
        required: false
        default: 'false'
        type: boolean

jobs:
  code-quality-manual-test:
    name: Manual Test on Salesforce Files
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      # Run the action against all Salesforce test files
      - name: Run action on all Salesforce test files
        id: code-scan
        uses: ./
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          sourcePath: "language-tests/salesforce/files/"
          installSalesforcePlugins: true
          check-name: "Salesforce Manual Quality Check"
          
          # Manual test settings - scan all files, don't fail by default
          scanChangedFilesOnly: false                  # Scan all files (no PR context)
          failOnQualityIssues: ${{ github.event.inputs.fail_on_issues }}
          
          # Relaxed thresholds for manual testing
          maxCriticalViolations: 50
          maxMediumViolations: 100
          
          file-types-config: |
            [
              {
                "name": "Classes",
                "sourcePath": "language-tests/salesforce/files/classes/",
                "fileExtensions": [".cls", ".cls-meta.xml"],
                "analyzer": "pmd",
                "rulesPaths": [
                  "./language-tests/salesforce/rulesets/pmd/apex/ruleset.xml"
                ]
              },
              {
                "name": "LWC",
                "sourcePath": "language-tests/salesforce/files/lwc/",
                "fileExtensions": [".js"],
                "analyzer": "eslint",
                "rulesPaths": [
                  "./language-tests/salesforce/rulesets/eslint/lwc/standard-ruleset.js"
                ]
              },
              {
                "name": "Aura",
                "sourcePath": "language-tests/salesforce/files/aura/",
                "fileExtensions": [".js"],
                "analyzer": "eslint",
                "rulesPaths": [
                  "./language-tests/salesforce/rulesets/eslint/aura/standard-ruleset.js"
                ]
              },
              {
                "name": "Fields",
                "sourcePath": "language-tests/salesforce/files/objects/",
                "fileExtensions": [".field-meta.xml"],
                "analyzer": "pmd",
                "rulesPaths": [
                  "./language-tests/salesforce/rulesets/pmd/xml/field-ruleset.xml"
                ]
              }
            ]

      # Show results summary
      - name: Show results summary
        run: |
          echo "Total violations: ${{ steps.code-scan.outputs.total-violations }}"
          echo "Critical violations: ${{ steps.code-scan.outputs.critical-violations }}"
          echo "Medium violations: ${{ steps.code-scan.outputs.medium-violations }}"
          echo "Action required: ${{ steps.code-scan.outputs.action-required }}"
